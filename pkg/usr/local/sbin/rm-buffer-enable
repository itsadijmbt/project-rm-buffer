#!/bin/bash
set -euo pipefail
WRAPPER=/usr/local/bin/rm
BIN=/usr/local/bin/rm-buffer
if [ ! -x "$BIN" ]; then
  echo "rm-buffer binary not found at $BIN" >&2
  exit 1
fi
if [ -e "$WRAPPER" ] && ! grep -q 'rm-buffer wrapper' "$WRAPPER" 2>/dev/null; then
  BACKUP="$WRAPPER.bak.$(date +%s)"
  echo "Backing up existing $WRAPPER -> $BACKUP"
  mv -f "$WRAPPER" "$BACKUP"
fi
cat > "$WRAPPER" <<'WEOF'
#!/bin/bash
# rm-buffer wrapper
# marker: "rm-buffer wrapper"
BINARY="/usr/local/bin/rm-buffer"
if [ $# -eq 0 ]; then
  exec /bin/rm
fi
exec "$BINARY" "$(pwd -P)" -buffer "$@"
WEOF
chmod 0755 "$WRAPPER"
echo "Global wrapper installed at $WRAPPER (backed up old one if present)."
